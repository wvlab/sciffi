\input regression-test.tex\relax
\documentclass{minimal}
\usepackage{sciffi-python}
\directlua{require("sciffi-cosmo")}

\begin{document}
    \begin{sciffi}{python}[portal=cosmo]
        import os
        import socket
        from sciffi.cosmo import message as msg

        def main():
            port = int(os.environ["SCIFFI_PORT"])
            host = "127.0.0.1"

            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.connect((host, port))

            sock.sendall(msg.HandshakeMessage(version=0).pack(0))
            sock.sendall(msg.WriteMessage(data=r"\textbf{Hello from Python!}").pack(1))
            sock.sendall(msg.CloseMessage().pack(2))

            sock.close()

        if __name__ == "__main__":
            main()
    \end{sciffi}
\end{document}
